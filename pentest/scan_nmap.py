import sys

try:

    import nmap

except Exception:

    sys.exit('[!] Install the nmap library: pip install python-nmap')

if len(sys.argv) != 5:

    sys.exit('[!] Please provide four arguments: first the targets, second the ports, third the username and fourth '
             'the password')
else:

    password = str(sys.argv[4])
    username = str(sys.argv[3])
    ports = str(sys.argv[2])
    hosts = str(sys.argv[1])


def scan_host(target, port):
    scanner = nmap.PortScanner()
    print(scanner.scan(target, port))


def resource_file_builder(dir, user, passwd, ips, port_num, hosts_file):

    """Função para criar arquivo de recurso do metasploit
    o arquivo com extenção .rc deve ser executado com o seguinte comando
    msfconsole -r ssh_login.rc
    No exemplo abaixo é feito um ataque no serviço SSH dos alvos"""

    ssh_login_rc = '%s/ssh_login.rc' % (dir)
    bufsize = 0
    set_module = 'use auxiliary/scanner/ssh/ssh_login\n'
    set_user = 'set username {}\n'.format(user)
    set_passwd = 'set password {}\n'.format(passwd)
    set_rhosts = 'set rhosts file:{}\n'.format(hosts_file)
    set_rport = 'set rport {}\n'.format(ports)
    execute = 'run\n'
    f = open(ssh_login_rc, 'w', bufsize)
    f.write(set_module)
    f.write(set_user)
    f.write(set_passwd)
    f.write(set_rhosts)
    f.write(set_rport)
    f.write(execute)
    f.close()
