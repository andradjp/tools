import socket
import fcntl
import struct
from os import listdir
import urllib.request, urllib.error


def get_interfaces():
    return listdir('/sys/class/net')


def get_ip(interface):
    try:

        s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        ip_addr = (
            socket.inet_ntoa(fcntl.ioctl(s.fileno(), 0x8915, struct.pack('256s', interface[:15].encode()))[20:24]))
        return ip_addr

    except OSError:
        pass

    except Exception:
        print('Unknow error!')


def get_public_ip():
    try:
        with urllib.request.urlopen('http://ip.42.pl/raw') as response:
            public_ip = response.read()

    except urllib.error.HTTPError as error:
        print('There was an error trying to get your Public IP: %s') % (error)

    except urllib.error.URLError as error:
        print('There was an error trying to get your Public IP: %s') % (error)

    return public_ip


for x in get_interfaces():
    print(('Interface %s IP %s') % (x, get_ip(x)))
